<div class="col-12">
  <h3>{{.title}}</h3>
  <hr/>
  <form id="form-{{.id}}" data-next="{{.next}}" action="{{.action}}" method="{{.method}}">
    {{ .csrfField }}
    {{range .fields}}
      {{if eq .type "text"}}
        <div class="form-group">
          <label for="{{.id}}">{{.label}}</label>
          <input type="text" class="form-control" id="{{.id}}" name="{{.id}}" value="{{.value}}" aria-describedby="{{.id}}Help" placeholder="{{.hint}}" {{if .readonly}}readonly{{end}}>
          <small id="{{.id}}Help" class="form-text text-muted">{{.helper}}</small>
        </div>
      {{else if eq .type "email"}}
        <div class="form-group">
          <label for="{{.id}}">{{.label}}</label>
          <input type="email" class="form-control" id="{{.id}}" name="{{.id}}" value="{{.value}}" aria-describedby="{{.id}}Help" placeholder="{{.hint}}" {{if .readonly}}readonly{{end}}>
          <small id="{{.id}}Help" class="form-text text-muted">{{.helper}}</small>
        </div>
      {{else if eq .type "password"}}
        <div class="form-group">
          <label for="{{.id}}">{{.label}}</label>
          <input type="password" class="form-control" id="{{.id}}" name="{{.id}}" value="{{.value}}" aria-describedby="{{.id}}Help" placeholder="{{.hint}}">
          <small id="{{.id}}Help" class="form-text text-muted">{{.helper}}</small>
        </div>
      {{else if eq .type "textarea"}}
        <div class="form-group">
          <label for="{{.id}}">{{.label}}</label>
          <textarea class="form-control" id="{{.id}}" name="{{.id}}" rows="{{.row}}" aria-describedby="{{.id}}Help" placeholder="{{.hint}}">{{.value}}</textarea>
          <small id="{{.id}}Help" class="form-text text-muted">{{.helper}}</small>
        </div>
      {{else if eq .type "hidden"}}
        <input type="hidden" class="form-control" id="{{.id}}" name="{{.id}}" value="{{.value}}">
      {{end}}
    {{end}}
    <button type="submit" class="btn btn-primary">{{t .lang "buttons.submit"}}</button>
    <button type="reset" class="btn btn-secondary">{{t .lang "buttons.reset"}}</button>
  </form>
</div>

<script>
$(function(){
  $("#form-{{.id}}").submit(function(e){
    e.preventDefault();
    $.ajax({
      url: e.target.action,
      type: e.target.method,
      data: $("#form-{{.id}}").serialize()
    }).done(function(data) {
      if(data.message){
        alert(data.message);
      }
      window.location.href = e.target.dataset.next;
    }).fail(function(xhr, status){
      alert(xhr.responseText);
    });

  });
});
</script>
